package br.com.dailyutilities.arrays;

import java.util.ArrayList;

public class BreakMessageWithFixedLenghtAndHeader {

//	private static final int DEFAULT_LENGHT = 599;
//	private static final String DEFAULT_HEADER = ".0593.";
	private static final int DEFAULT_LENGHT = 605;
	private static final String DEFAULT_HEADER = "0x0205930x03";
	
	public static void main(String[] args) {
		ArrayList<Object> list_msg = new ArrayList<Object>();

		System.out.println("####### INICIO #####\n");

		Object raw_msg_01 = createMessage(1);
		System.out.println("####### Caso 1 - Mensagem com tamanho de: " + raw_msg_01.toString().length());
		System.out.println(raw_msg_01.toString());
		
		list_msg = messageBreakEveryDefinedAmountCaracter(raw_msg_01, DEFAULT_LENGHT);

		System.out.println("\n####### Mensagem dividida a cada " + DEFAULT_LENGHT + " caracteres (593 caracteres de mensagem + "+(DEFAULT_LENGHT-593)+" de Header)");
		for (Object objectItem : list_msg)
			System.out.println(objectItem);
		
		list_msg = dividePorHeader(list_msg);

		System.out.println("\n####### Mensagem a ser considerado e persistido");
		for (Object objectItem : list_msg)
			System.out.println(objectItem);

		System.out.println("\n###################################################################");
		Object raw_msg_02 = createMessage(2);
		System.out.println("\n####### Caso 2 - Mensagem com tamanho de: " + raw_msg_02.toString().length());
		System.out.println(raw_msg_02.toString());

		list_msg = messageBreakEveryDefinedAmountCaracter(raw_msg_02, DEFAULT_LENGHT);
		System.out.println("\n####### Mensagem dividida a cada " + DEFAULT_LENGHT + " caracteres (593 caracteres de mensagem + "+(DEFAULT_LENGHT-593)+" de Header)");
		for (Object objectItem : list_msg)
			System.out.println(objectItem);
		
		list_msg = dividePorHeader(list_msg);

		System.out.println("\n####### Mensagem a ser considerado e persistido");
		for (Object objectItem : list_msg)
			System.out.println(objectItem);
		
		System.out.println("\n###################################################################");
		Object raw_msg_03 = createMessage(3);
		System.out.println("\n####### Caso 3 - Mensagem com tamanho de: " + raw_msg_03.toString().length());
		System.out.println(raw_msg_03.toString());

		list_msg = messageBreakEveryDefinedAmountCaracter(raw_msg_03, DEFAULT_LENGHT);
		System.out.println("\n####### Mensagem dividida a cada " + DEFAULT_LENGHT + " caracteres (593 caracteres de mensagem + "+(DEFAULT_LENGHT-593)+" de Header)");
		for (Object objectItem : list_msg)
			System.out.println(objectItem);
		
		list_msg = dividePorHeader(list_msg);

		System.out.println("\n####### Mensagem a ser considerado e persistido");
		for (Object objectItem : list_msg)
			System.out.println(objectItem);

	}

	public static Object createMessage(Integer typeMessage) {

		// Mensagem com 2 registro validos e um particionado
		if (typeMessage == 1) {
			return "0x0205930x0313M17  201802050345290130003000   552914******5429000000235631SAMAST02 1517809529031 1517809529034 000003SAMAST02 1517809529067 1517809529067 00000015806600000007319200000023563111160                     D2272844                                        0000000            00         9868409860000000000000000000000000000000000000000000000000000000020180205034529000000000000000000E00000000000000000000000000000000000000000000000000000000000000000000000000000000N00000000000000000000000000000000    0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000x0205930x0313M17  201802050345290120003000   549167******7656000000001100SAMAST02 1517809529071 1517809529073 000002N        0000000000000000000000000000000000838637000000000342000000001100014788     7573810540000005O6S1A6SGO OSC                 PALHOCA       BRA8999812803633838637     0736879868409860500000000000000000000000000000000000000000000000000000020180205034529000000000000000000E00000000000000000000000000000000000000000000000000000000000000000000000000000000N00000000000000000000000000000000    0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000x0205930x0313M17  201802050345290130003000   549319******2243000000010239SAMAST02 1517809529020 1517809529022 000002SAMAST02 1517809529098 1517809529098 00000052250800000000318000000001023912088                     MS000022                                ";

		} // Mensagem com inicio invalido
		else if(typeMessage == 2) {
			return "0000000            00         9868409860000000000000000000000000000000000000000000000000000000020180205034528000000000000000000E00000000000000000000000000000000000000000000000000000000000000000000000000000000N00000000000000000000000000000000    0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000x0205930x0313M17  201802050345280120003000   552914******5429000000036708SAMAST02 1517809528951 1517809528954 000003N        0000000000000000000000000000000000978734000000011402000000036708011160     000000000633624D2272844WAPPAPREMIUMCLIENTES*W SAO PAULO     BRA5965810020500609970     0437889868409860500000000000000000000000000000000000000000000000000000020180205034528000000000000000000E00000000000000000000000000000000000000000000000000000000000000000000000000000000N00000000000000000000000000000000    000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000";
		}
		else {
			return "0x0205930x0313M17  201802050345290130003000   552914******5429000000235631SAMAST02 1517809529031 1517809529034 000003SAMAST02 1517809529067 1517809529067 00000015806600000007319200000023563111160                     D2272844                                        0000000            00         9868409860000000000000000000000000000000000000000000000000000000020180205034529000000000000000000E00000000000000000000000000000000000000000000000000000000000000000000000000000000N00000000000000000000000000000000    0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000x0205930x0313M17  201802050345290120003000   549167******7656000000001100SAMAST02 1517809529071 1517809529073 000002N        0000000000000000000000000000000000838637000000000342000000001100014788     7573810540000005O6S1A6SGO OSC                 PALHOCA       BRA8999812803633838637     0736879868409860500000000000000000000000000000000000000000000000000000020180205034529000000000000000000E00000000000000000000000000000000000000000000000000000000000000000000000000000000N00000000000000000000000000000000    0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000x0205930x0313M17  201802050345290130003000   549319******2243000000010239SAMAST02 1517809529020 1517809529022 000002SAMAST02 1517809529098 1517809529098 00000052250800000000318000000001023912088                     MS000022                                "
					+ "        0000000            00         9868409860000000000000000000000000000000000000000000000000000000020180205034528000000000000000000E00000000000000000000000000000000000000000000000000000000000000000000000000000000N00000000000000000000000000000000    0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000x0205930x0313M17  201802050345280120003000   552914******5429000000036708SAMAST02 1517809528951 1517809528954 000003N        0000000000000000000000000000000000978734000000011402000000036708011160     000000000633624D2272844WAPPAPREMIUMCLIENTES*W SAO PAULO     BRA5965810020500609970     0437889868409860500000000000000000000000000000000000000000000000000000020180205034528000000000000000000E00000000000000000000000000000000000000000000000000000000000000000000000000000000N00000000000000000000000000000000    000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000";
		}
		
//		if (typeMessage == 1) {
//			return ".0593.13M17  201802050345290130003000   552914******5429000000235631SAMAST02 1517809529031 1517809529034 000003SAMAST02 1517809529067 1517809529067 00000015806600000007319200000023563111160                     D2272844                                        0000000            00         9868409860000000000000000000000000000000000000000000000000000000020180205034529000000000000000000E00000000000000000000000000000000000000000000000000000000000000000000000000000000N00000000000000000000000000000000    000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000.0593.13M17  201802050345290120003000   549167******7656000000001100SAMAST02 1517809529071 1517809529073 000002N        0000000000000000000000000000000000838637000000000342000000001100014788     7573810540000005O6S1A6SGO OSC                 PALHOCA       BRA8999812803633838637     0736879868409860500000000000000000000000000000000000000000000000000000020180205034529000000000000000000E00000000000000000000000000000000000000000000000000000000000000000000000000000000N00000000000000000000000000000000    000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000.0593.13M17  201802050345290130003000   549319******2243000000010239SAMAST02 1517809529020 1517809529022 000002SAMAST02 1517809529098 1517809529098 00000052250800000000318000000001023912088                     MS000022                                ";
//
//		} // Mensagem com inicio invalido
//		else if(typeMessage == 2) {
//			return "0000000            00         9868409860000000000000000000000000000000000000000000000000000000020180205034528000000000000000000E00000000000000000000000000000000000000000000000000000000000000000000000000000000N00000000000000000000000000000000    000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000.0593.13M17  201802050345280120003000   552914******5429000000036708SAMAST02 1517809528951 1517809528954 000003N        0000000000000000000000000000000000978734000000011402000000036708011160     000000000633624D2272844WAPPAPREMIUMCLIENTES*W SAO PAULO     BRA5965810020500609970     0437889868409860500000000000000000000000000000000000000000000000000000020180205034528000000000000000000E00000000000000000000000000000000000000000000000000000000000000000000000000000000N00000000000000000000000000000000    000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000";
//		}
//		else {
//			return ".0593.13M17  201802050345290130003000   552914******5429000000235631SAMAST02 1517809529031 1517809529034 000003SAMAST02 1517809529067 1517809529067 00000015806600000007319200000023563111160                     D2272844                                        0000000            00         9868409860000000000000000000000000000000000000000000000000000000020180205034529000000000000000000E00000000000000000000000000000000000000000000000000000000000000000000000000000000N00000000000000000000000000000000    000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000.0593.13M17  201802050345290120003000   549167******7656000000001100SAMAST02 1517809529071 1517809529073 000002N        0000000000000000000000000000000000838637000000000342000000001100014788     7573810540000005O6S1A6SGO OSC                 PALHOCA       BRA8999812803633838637     0736879868409860500000000000000000000000000000000000000000000000000000020180205034529000000000000000000E00000000000000000000000000000000000000000000000000000000000000000000000000000000N00000000000000000000000000000000    000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000.0593.13M17  201802050345290130003000   549319******2243000000010239SAMAST02 1517809529020 1517809529022 000002SAMAST02 1517809529098 1517809529098 00000052250800000000318000000001023912088                     MS000022                                "
//					+ "        0000000            00         9868409860000000000000000000000000000000000000000000000000000000020180205034528000000000000000000E00000000000000000000000000000000000000000000000000000000000000000000000000000000N00000000000000000000000000000000    000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000.0593.13M17  201802050345280120003000   552914******5429000000036708SAMAST02 1517809528951 1517809528954 000003N        0000000000000000000000000000000000978734000000011402000000036708011160     000000000633624D2272844WAPPAPREMIUMCLIENTES*W SAO PAULO     BRA5965810020500609970     0437889868409860500000000000000000000000000000000000000000000000000000020180205034528000000000000000000E00000000000000000000000000000000000000000000000000000000000000000000000000000000N00000000000000000000000000000000    000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000";
//		}
		
	}

	public static ArrayList<Object> messageBreakEveryDefinedAmountCaracter(Object rawObject, int definedAmount) {

		ArrayList<Object> list = new ArrayList<Object>();

		if (rawObject != null) {

			String messageString = rawObject.toString();

			Integer index = 0, layout_lenght = definedAmount, messageLength = messageString.length();

			// Divide mensagem em 599 caracteress
			while (index < messageLength) {

				list.add(messageString.substring(index, Math.min(index + layout_lenght, messageLength)));

				index += layout_lenght;
			}
		}

		return list;
	}

	public static ArrayList<Object> dividePorHeader(ArrayList<Object> list_object) {

		ArrayList<Object> order_list = new ArrayList<Object>();
		String obj_part = "";

		for (Object objectItem : list_object) {

			String messageString = objectItem.toString();
			Integer messageLength = messageString.length();

			Integer nextHeader = messageString.indexOf(DEFAULT_HEADER);

			if (nextHeader > 0 || nextHeader == -1) {
				
				nextHeader = nextHeader == -1 ? messageLength : nextHeader;

				if (!obj_part.isEmpty()) {		
					
					obj_part += messageString.substring(0, nextHeader);
					
					if(obj_part.length() == DEFAULT_LENGHT) {
						order_list.add(obj_part);
					}else {
						System.out.println("\n####### Mensagem desconsiderada por não possuir o tamanho denifido de layout:\n"+obj_part);
						obj_part = "";
					}
					
					
					obj_part = messageString.substring(nextHeader, messageLength);
				} else {
					System.out.println("\n####### Mensagem desconsiderada por não possuir um Header no inicio da mensagem:\n"
							+ messageString.substring(0, nextHeader));
					
					obj_part = messageString.substring(nextHeader, messageLength);
				}

			}
			else if(messageLength < DEFAULT_LENGHT ) {
				
				obj_part += messageString;
				
			}else {
				order_list.add(objectItem);
			}

		}

		if(!obj_part.isEmpty()) {
			System.out.println("\n####### Mensagem desconsiderada por não possuir o tamanho denifido de layout:\n"+obj_part);
			obj_part = "";
		}
		
		return order_list;
	}

}
